---
title: "Introduction to spnaf"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to spnaf}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The _spnaf_ package is developed for calculating spatial network autocorrelation for flow data. Functions in the package are designed specifically to evaluate how networks are spatially clustered, in the form of **Gij statistic** which is presented in the [paper](https://link.springer.com/article/10.1007/s101090050013) written by Berglund and KarlstrÃ¶m.  


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
library(spnaf)
```

## Data: CA
The package has a dataset called **CA** which stands for California, US. This dataset contains migration amounts among CA counties in 2019. The data consists of origins and destinations of each residential flow.  
```{r}
dim(CA)
head(CA)
```

## Data: CA_polygon
The package also has a sf object called **CA_polygon** which is a *sf* class object that represents boundaries of CA counties. It has id column and geometry column and can be plotted by attaching the *sf* package. The polygon can be joined with **CA** since it has id column that matches County code of **CA**. You can learn more about how to deal with spatial objects at https://r-spatial.github.io/sf/.

```{r}
library(sf)
plot(CA_polygon, col = 'white', main = 'CA polygon')
```

## Function: Gij.polygon
*spnaf* package aims to measure spatial density of networks, which have origins (starting point) and destinations (ending point). Main function of *spnaf* is called **Gij.polygon** and the first main input of the function is **df** which is OD data in a data.frame form that must contain "oid", "did", and "n"(please refer to the help document) like CA above. The second important input is **shape** which is corresponding polygon object in *sf* class. The function also inherited two parameters from [_spdep_](https://r-spatial.github.io/spdep/) such as **queen, snap**. The parameter **method** is one of c("t", "o", "d") which stand for total, origins only, and destinations only respectively(Please check [this paper](https://link.springer.com/article/10.1007/s10109-008-0068-2) to get more information about the method). The last parameter **n** is used for bootstrapping the results since there would be violation of the assumption of normality when one try to calculate a spatial statistic with polygons(see how authors told about it in [this paper]()).

```{r}
args(Gij.polygon)
```

### How to execute
```{r}
## data preparation
CA <- spnaf::CA
OD <- cbind(CA$FIPS.County.Code.of.Geography.B, CA$FIPS.County.Code.of.Geography.A)
OD <- cbind(OD, CA$Flow.from.Geography.B.to.Geography.A)
OD <- data.frame(OD)
names(OD) <- c("oid", "did", "n")
OD$n <- as.numeric(OD$n)
OD <- OD[order(OD[,1], OD[,2]),]
head(OD)

CA_polygon <- spnaf::CA_polygon

## Execution
result <- Gij.polygon(df = OD, shape = CA_polygon, queen = TRUE, snap = 1,
method = 't', n = 1000)

head(result[[1]])
head(result[[2]])
```

### Interpretation of the result
To be continued...
